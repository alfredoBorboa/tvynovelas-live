<!doctype html>
<html>
<head>
<title>Votación Live Tv y Novelas 2015</title>

<script src="/socket.io/socket.io.js"></script>
<script src="resources/jquery.min.js"></script>

</head>

<body>
<h1>Mejor Telenovela: <span id="votosTotales"></span></h1>
<div id="candidatos">
<div id="ac1">Mi corazón es tuyo: <span id="conteoAc1"></span><br/></div><br/>
<div id="ac2">Lo que la vida me robó: <span id="conteoAc2"></span><br/></div><br/>
<div id="ac3">El color de la pasión: <span id="conteoAc3"></span><br/></div><br/>
<div id="ac4">Que pobres tan ricos: <span id="conteoAc4"></span><br/></div><br/>
<div id="ac5">Yo no creo en los hombres: <span id="conteoAc5"></span><br/></div><br/>
</div> <!-- candidatos -->
<script>
  var socket = io();
  var contador = 0;
    
  var idCandidatoDirector;
  var idConteoDirector;
  var idContadorDirector;

  var contadores = [ 0, 0, 0, 0, 0 ];
    
  var jurados = [ "Pedro Damián", "Mara Patricia Castañeda", "Alfredo Gudinni", "Claudia de Icaza", "Karla Martínez", "Flor Rubio", "Aurora Valle", "Lupita Martínez", "Karina Duprez", "Salvador Mejía", "Nicandro Díaz", "Roberto Hernández", "TVYNOV" ];
  var aCandidatos = [ "Mi corazón es tuyo", "Lo que la vida me robó", "El color de la pasión", "Que pobres tan ricos", "Yo no creo en los hombres" ];
  var idCandidatos = [ 1, 2, 3, 4, 5 ];

  socket.on('votoHaciaMonitor', function(msg){

  if( contador < 13 ){
    
    var splitMsg = msg.split("");
    var idCandidato = "#ac" + splitMsg[ 2 ];
    $( idCandidato ).append( jurados[ splitMsg[ 4 ] - 1 ] + "<br/>");
    
    var idConteo = "#conteoAc" + splitMsg[ 2 ];
    contadores[ splitMsg[ 2 ] - 1 ]++;
    $( idConteo ).html( contadores[ splitMsg[ 2 ] - 1 ] );
    
    if( splitMsg[ 4 ] == 1 ){
        idCandidatoDirector = idCandidato;
        idConteoDirector = idConteo;
        idContadorDirector = splitMsg[ 2 ] - 1;
    }
  
    contador++;

    $( "#votosTotales" ).html( contador );

  } // if contador < 13
  
  if( contador == 13 ){
    $( "#votosTotales" ).html( "Votos Completos" );
    
    var votoMaximoAc = Math.max( contadores[ 0 ], contadores[ 1 ], contadores[ 2 ], contadores[ 3 ], contadores[ 4 ] ); 

    var arrayGanadores = [];
    var arrayIdCandidatosG = [];
      
    for( var i = 0; i < contadores.length; i++ ){
      if( contadores[ i ] == votoMaximoAc ){
        arrayGanadores.push( aCandidatos[ i ] );
      }
    }
    
    if( arrayGanadores.length == 1 ){
      $( "#votosTotales" ).html( "Ganador: " + arrayGanadores[ 0 ] );
    }
      
    if( arrayGanadores.length > 1 ){
        
      contadores[ idContadorDirector ]++;
      $( idConteoDirector ).html( contadores[ idContadorDirector ] );
        
      votoMaximoAc = Math.max( contadores[ 0 ], contadores[ 1 ], contadores[ 2 ], contadores[ 3 ], contadores[ 4 ] );
        
      arrayGanadores = [];
        
      for( var i = 0; i < contadores.length; i++ ){
      if( contadores[ i ] == votoMaximoAc ){
        arrayGanadores.push( aCandidatos[ i ] );
        arrayIdCandidatosG.push( idCandidatos[ i ] );
      }
    }
    if( arrayGanadores.length == 1 ){
      $( "#votosTotales" ).html( "Ganador: " + arrayGanadores[ 0 ] );
    }
    if( arrayGanadores.length > 1 ){
        votacionSecundaria( arrayGanadores, arrayIdCandidatosG );
    }
      
    } //if arrayGanadores.length > 1
    
    
  } // if contador == 13

  }); // socket.on voto  
    
    function votacionSecundaria( candidatosSecundarios, arrayIdCandidatosG2 ){
        $( "#votosTotales" ).html( "Desempate" );
        $( "#candidatos" ).html( "" );
        contador = 0;
        contadores = [ 0, 0, 0, 0, 0 ];
        for( var i = 0; i < candidatosSecundarios.length; i++ ){
            $( "#candidatos" ).append( "<div id='ac" + arrayIdCandidatosG2[ i ] + "'>" + candidatosSecundarios[ i ] + ": <span id='conteoAc" + arrayIdCandidatosG2[ i ] + "'></span><br/></div><br/>" );
        }
        
        for( var i = 0; i < arrayIdCandidatosG2.length; i++ ){
            candidatosSecundarios.push( arrayIdCandidatosG2[ i ] );
        }
        
        socket.emit( "convocaSegundaVotacion", candidatosSecundarios );
        
    }
    
</script>
</body>
</html>
